# ===================================================================
# Shadowrocket V15: 您的个人模块化配置中心 (嵌套故障转移版)
# 设计师: hixcao & AI Assistant
# 新特性: 引入三层嵌套策略组与Fallback机制，提升健壮性与简洁性
# ===================================================================

[General]
bypass-system = true
skip-proxy = 192.168.0.0/16,10.0.0.0/8,172.16.0.0/12,localhost,*.local
tun-excluded-routes = 10.0.0.0/8, 100.64.0.0/10, 127.0.0.0/8, 169.254.0.0/16, 172.16.0.0/12, 192.0.0.0/24, 192.0.2.0/24, 192.88.99.0/24, 192.168.0.0/16, 198.51.100.0/24, 203.0.113.0/24, 224.0.0.0/4, 255.255.255.255/32, 239.255.255.250/32
dns-server = 119.29.29.29,114.114.114.114,223.5.5.5,system
fallback-dns-server = system
ipv6 = false
prefer-ipv6 = false
dns-fallback-system = false
dns-direct-system = false
icmp-auto-reply = true
always-reject-url-rewrite = false
private-ip-answer = false

# ===================================================================
# 策略组 (Proxy Group): 三层嵌套结构
# ===================================================================
[Proxy Group]
# --- Level 3 (顶层应用策略): 您在小火箭里最常操作的层级 ---
# 决定了每个规则集具体使用哪种代理方案
🐠 漏网之鱼 = select, ♻️ 自动选择, 🈯️ 手动选择
🤖️ 人工智能 = select, 🇺🇸 美国优选, 🈯️ 手动选择
🪙 加密货币 = select, ♻️ 自动选择, 🈯️ 手动选择
🌀 谷歌服务 = select, 🇺🇸 美国优选, 🈯️ 手动选择
📲 Telegram = select, ♻️ 自动选择, 🈯️ 手动选择
Ⓜ️ 微软服务 = select, DIRECT, ♻️ 自动选择
🍎 苹果服务 = select, DIRECT, ♻️ 自动选择

# --- Level 2 (组合策略包): 智能方案层 ---
# Fallback: 优先用 🇺🇸 美国节点, 如果全部故障, 自动切换到 ♻️ 自动选择, 保证服务不中断
🇺🇸 美国优选 = fallback, 🇺🇸 美国节点, ♻️ 自动选择
# Select: 将所有地区节点打包成一个“手动选择”选项, 简化顶层策略
🈯️ 手动选择 = select, 🇭🇰 香港节点, 🇺🇸 美国节点, 🇯🇵 日本节点, 🇸🇬 新加坡节点, 🇬🇧 英国节点

# --- Level 1 (底层节点包): 基础节点筛选层 ---
# URL-Test: 从您的所有节点中, 筛选出特定地区的节点
♻️ 自动选择 = url-test,url=http://www.gstatic.com/generate_24,interval=300,tolerance=100,timeout=5,policy-regex-filter=.*
🇭🇰 香港节点 = url-test,url=http://www.gstatic.com/generate_204,interval=600,tolerance=100,timeout=5,policy-regex-filter=(?i)港|HK|Hong
🇺🇸 美国节点 = url-test,url=http://www.gstatic.com/generate_204,interval=600,tolerance=100,timeout=5,policy-regex-filter=(?i)美国|美國|US|States|American
🇯🇵 日本节点 = url-test,url=http://www.gstatic.com/generate_204,interval=600,tolerance=100,timeout=5,policy-regex-filter=(?i)日本|JP|Japan
🇸🇬 新加坡节点 = url-test,url=http://www.gstatic.com/generate_204,interval=600,tolerance=100,timeout=5,policy-regex-filter=(?i)新加坡|狮城|SG
🇬🇧 英国节点 = url-test,url=http://www.gstatic.com/generate_204,interval=600,tolerance=100,timeout=5,policy-regex-filter=(?i)英国|UK|England


[Rule]
# ===================================================================
# 规则匹配顺序: 从上到下，高优先级在前
# ===================================================================

# --- 1. (最高优先级) 您的个人云端规则 ---
# 由 hixcao 在线维护的、您自己的专属规则集
RULE-SET,https://raw.githubusercontent.com/hixcao/My-Shadowrocket-Rules/main/OpenAI.conf,🤖️ 人工智能
RULE-SET,https://raw.githubusercontent.com/hixcao/My-Shadowrocket-Rules/main/Gemini.conf,🤖️ 人工智能
RULE-SET,https://raw.githubusercontent.com/hixcao/My-Shadowrocket-Rules/main/Google.conf,🌀 谷歌服务
RULE-SET,https://raw.githubusercontent.com/hixcao/My-Shadowrocket-Rules/main/Crypto.conf,🪙 加密货币

# --- 2. (次优先级) 常用国际服务公共规则 ---
# 社区维护的、高质量的常用服务规则集
RULE-SET,https://whatshub.top/rule/Telegram.list,📲 Telegram
RULE-SET,https://whatshub.top/rule/Microsoft.list,Ⓜ️ 微软服务
RULE-SET,https://whatshub.top/rule/Apple.list,🍎 苹果服务
RULE-SET,https://whatshub.top/rule/AppStore.list,🍎 苹果服务

# --- 3. (拦截层) 广告与跟踪器 ---
# 拦截广告、分析、隐私跟踪等，匹配到的流量将根据策略组决定走向
# RULE-SET,https://whatshub.top/rule/AntiAD.list,REJECT  # 可选：如果想直接拦截，去掉前面的 #
RULE-SET,https://raw.githubusercontent.com/Johnshall/Shadowrocket-ADBlock-Rules-Forever/master/sr_top500_banlist.conf,🐠 漏网之鱼

# --- 4. (放行层) 国内服务与局域网 ---
# 确保所有国内服务、局域网地址都直接连接
GEOIP,CN,DIRECT
RULE-SET,https://whatshub.top/rule/ChinaMedia.list,DIRECT
RULE-SET,https://whatshub.top/rule/WeChat.list,DIRECT
RULE-SET,https://whatshub.top/rule/ASN-CN.list,DIRECT

# --- 5. (最终规则) 兜底策略 ---
# 所有以上规则都未匹配到的流量，将执行最终的直连策略
FINAL,DIRECT
